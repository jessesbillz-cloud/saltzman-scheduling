
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WPMS Inspection Request</title>
</head>
<body style="font-family:sans-serif;max-width:500px;margin:0 auto;padding:16px;background:#f5f5f5;">

<h2 style="margin:0 0 4px;">Inspection Request</h2>
<p style="margin:0 0 16px;color:#666;font-size:14px;">Woodland Park MOD â€” Lusardi</p>

<div id="formView">

<label style="display:block;font-weight:bold;font-size:14px;margin-bottom:6px;">Photo of Inspection Request *</label>
<div id="photoBox" onclick="document.getElementById('photoIn').click()" style="border:2px dashed #ccc;border-radius:8px;padding:40px 20px;text-align:center;background:#fff;cursor:pointer;margin-bottom:16px;">
<div id="photoPrompt">&#128247; Tap to take photo or upload</div>
<img id="photoPreview" style="display:none;max-width:100%;max-height:300px;border-radius:4px;">
</div>
<input type="file" id="photoIn" accept="image/*" capture="environment" onchange="showPhoto(this)" style="display:none;">

<label style="display:block;font-weight:bold;font-size:14px;margin-bottom:6px;">Inspection Date *</label>
<input type="date" id="iDate" style="width:100%;padding:10px;font-size:16px;border:1px solid #ccc;border-radius:6px;margin-bottom:12px;box-sizing:border-box;">

<label style="display:block;font-weight:bold;font-size:14px;margin-bottom:6px;">Inspection Time *</label>
<input type="time" id="iTime" style="width:100%;padding:10px;font-size:16px;border:1px solid #ccc;border-radius:6px;margin-bottom:12px;box-sizing:border-box;">

<label style="display:block;font-weight:bold;font-size:14px;margin-bottom:6px;">Inspection Type *</label>
<select id="iType" style="width:100%;padding:10px;font-size:16px;border:1px solid #ccc;border-radius:6px;margin-bottom:12px;box-sizing:border-box;background:#fff;">
<option value="">Select type</option>
<option>Concrete</option>
<option>Grout</option>
<option>Rebar</option>
<option>Masonry</option>
<option>Structural Steel</option>
<option>Welding</option>
<option>Material ID</option>
<option>Bolting</option>
<option>Soil / Compaction</option>
<option>Other</option>
</select>

<label style="display:block;font-weight:bold;font-size:14px;margin-bottom:6px;">Subcontractor *</label>
<input type="text" id="iSub" placeholder="Company name" style="width:100%;padding:10px;font-size:16px;border:1px solid #ccc;border-radius:6px;margin-bottom:12px;box-sizing:border-box;">

<label style="display:block;font-weight:bold;font-size:14px;margin-bottom:6px;">Location / Notes</label>
<input type="text" id="iNotes" placeholder="Building, grid line, etc." style="width:100%;padding:10px;font-size:16px;border:1px solid #ccc;border-radius:6px;margin-bottom:20px;box-sizing:border-box;">

<button onclick="submitIR()" id="submitBtn" style="width:100%;padding:14px;font-size:16px;font-weight:bold;color:#fff;background:#c4451c;border:none;border-radius:8px;cursor:pointer;">Submit Inspection Request</button>

<p id="statusMsg" style="text-align:center;margin-top:12px;font-size:14px;display:none;"></p>

</div>

<div id="successView" style="display:none;text-align:center;padding-top:60px;">
<div style="font-size:48px;">&#9989;</div>
<h2>Request Submitted</h2>
<p style="color:#666;">Sent to Jesse Saltzman. It will appear on his calendar.</p>
<p id="irDisplay" style="font-weight:bold;color:#c4451c;font-size:18px;"></p>
<button onclick="resetForm()" style="margin-top:20px;padding:12px 24px;font-size:14px;font-weight:bold;color:#c4451c;background:none;border:2px solid #c4451c;border-radius:8px;cursor:pointer;">Submit Another</button>
</div>

<script>
var SUPABASE_URL='https://esxeusjjeuyhwwrtwpcv.supabase.co';
var ANON_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzeGV1c2pqZXV5aHd3cnR3cGN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3Mzg0MDYsImV4cCI6MjA4NjMxNDQwNn0.dBEhvcxnscwk1gmb3FGYexmLlrzbd60NFzkt4771IvE';
var photoFile=null;

function showPhoto(input){
if(input.files&&input.files[0]){
photoFile=input.files[0];
var r=new FileReader();
r.onload=function(e){
document.getElementById('photoPreview').src=e.target.result;
document.getElementById('photoPreview').style.display='block';
document.getElementById('photoPrompt').style.display='none';
document.getElementById('photoBox').style.borderStyle='solid';
document.getElementById('photoBox').style.borderColor='#2d7a3a';
};
r.readAsDataURL(input.files[0]);
}
}

function submitIR(){
var d=document.getElementById('iDate').value;
var t=document.getElementById('iTime').value;
var tp=document.getElementById('iType').value;
var sub=document.getElementById('iSub').value.trim();
if(!photoFile||!d||!t||!tp||!sub){
alert('Please fill in all required fields and upload a photo.');
return;
}
var btn=document.getElementById('submitBtn');
btn.textContent='Submitting...';
btn.disabled=true;
var fd=new FormData();
fd.append('photo',photoFile);
fd.append('mode','photo');
fd.append('project','WPMS');
fd.append('gc','Lusardi');
fd.append('inspection_date',d);
fd.append('inspection_time',t);
fd.append('inspection_types',JSON.stringify([tp]));
fd.append('subcontractor',sub);
fd.append('location_detail',document.getElementById('iNotes').value||'');
fetch(SUPABASE_URL+'/functions/v1/submit-inspection',{
method:'POST',
headers:{'Authorization':'Bearer '+ANON_KEY,'apikey':ANON_KEY},
body:fd
}).then(function(r){return r.json();}).then(function(data){
if(data.ir_number){
document.getElementById('irDisplay').textContent='IR #'+String(data.ir_number).padStart(4,'0');
document.getElementById('formView').style.display='none';
document.getElementById('successView').style.display='block';
}else{
alert('Error: '+(data.error||'Unknown error'));
btn.textContent='Submit Inspection Request';
btn.disabled=false;
}
}).catch(function(err){
alert('Connection error. Check internet and try again.');
btn.textContent='Submit Inspection Request';
btn.disabled=false;
});
}

function resetForm(){
document.getElementById('formView').style.display='block';
document.getElementById('successView').style.display='none';
document.getElementById('iDate').value='';
document.getElementById('iTime').value='';
document.getElementById('iType').selectedIndex=0;
document.getElementById('iSub').value='';
document.getElementById('iNotes').value='';
document.getElementById('photoPreview').style.display='none';
document.getElementById('photoPrompt').style.display='block';
document.getElementById('photoBox').style.borderStyle='dashed';
document.getElementById('photoBox').style.borderColor='#ccc';
document.getElementById('photoIn').value='';
document.getElementById('submitBtn').textContent='Submit Inspection Request';
document.getElementById('submitBtn').disabled=false;
photoFile=null;
}
</script>

</body>
</html>
